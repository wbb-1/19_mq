# CMIP 过程挖掘软件 - 测试文档

## 测试环境

- **操作系统**: Windows 10/11
- **Python 版本**: 3.9+
- **依赖**: pandas, pm4py, streamlit, graphviz
- **Graphviz**: 已安装并添加到 PATH (`C:\Program Files\Graphviz\bin`)

---

## 功能测试清单

### 1. 日志加载功能

| 测试项 | 操作步骤 | 预期结果 |
|--------|----------|----------|
| 使用示例日志 | 1. 打开应用 http://localhost:8888<br>2. 勾选"使用示例日志 (Log_09.csv)" | 显示"使用示例日志: Log_09.csv"，日志统计区域显示：总案例数 18909，总事件数 567270，部门数 5，同步任务数 1 |
| 上传自定义日志 | 1. 取消勾选"使用示例日志"<br>2. 点击"Browse files"上传 CSV 文件 | 显示"已上传: [文件名]"，日志统计区域显示相应数据 |
| 查看日志预览 | 点击"📋 查看日志预览（前100行）" | 展开显示 DataFrame 表格，包含 case_id, tran, rec_msg, send_msg, req_res, rel_res, roles, timestamp 等列 |

---

### 2. 参数配置功能

| 测试项 | 操作步骤 | 预期结果 |
|--------|----------|----------|
| 调整噪声阈值 | 拖动"噪声阈值 (IMf)"滑块 | 滑块值在 0.0-0.5 之间变化，步长 0.05 |
| 调整目标 F-measure | 拖动"目标 F-measure"滑块 | 滑块值在 0.8-1.0 之间变化，步长 0.01 |
| 调整最大迭代次数 | 修改"最大迭代次数"输入框 | 值在 1-10 之间变化 |
| 启用/禁用修复 | 勾选/取消"启用 CE-PNR 修复" | 复选框状态切换 |
| 清除缓存 | 点击"🔄 清除缓存" | 页面刷新，之前的挖掘结果被清除 |

---

### 3. 过程挖掘功能

| 测试项 | 操作步骤 | 预期结果 |
|--------|----------|----------|
| 开始挖掘 | 1. 确保日志已加载<br>2. 点击"开始挖掘" | 显示"正在执行 CMIP-IMR 算法..."，完成后显示"挖掘完成!" |
| 无日志时挖掘 | 1. 取消勾选"使用示例日志"且不上传文件<br>2. 点击"开始挖掘" | 显示警告"请先上传或选择日志文件" |
| 参数变化测试 | 1. 点击"清除缓存"<br>2. 修改噪声阈值为 0.0<br>3. 点击"开始挖掘"<br>4. 记录结果<br>5. 清除缓存<br>6. 修改噪声阈值为 0.3<br>7. 点击"开始挖掘" | 两次结果的 Fitness/Precision/F-measure 可能不同 |

---

### 4. 质量评价功能

| 测试项 | 操作步骤 | 预期结果 |
|--------|----------|----------|
| 查看 N0 指标 | 挖掘完成后查看"初始模型 N0"区域 | 显示 Fitness、Precision、F-measure 三个指标，值在 0-1 之间 |
| 查看 N1 指标 | 挖掘完成后查看"最优模型 N1"区域 | 显示 Fitness、Precision、F-measure 三个指标，如有改进会显示绿色增量 |
| 指标对比 | 对比 N0 和 N1 的指标 | N1 的 F-measure 应 >= N0 的 F-measure |

**示例正常值**（噪声阈值 0.2）：
- Fitness: ~0.9347
- Precision: ~0.9347
- F-measure: ~0.9347

---

### 5. Petri 网可视化功能

| 测试项 | 操作步骤 | 预期结果 |
|--------|----------|----------|
| 查看 N0 模型 | 点击"N0 (初始模型)"标签页 | 显示 Petri 网图像（PNG 格式），下方显示 Places、Transitions、Arcs 数量 |
| 查看 N1 模型 | 点击"N1 (最优模型)"标签页 | 显示 Petri 网图像（PNG 格式），下方显示 Places、Transitions、Arcs 数量 |
| Graphviz 不可用 | 如果 Graphviz 未安装 | 显示黄色警告"Graphviz 未正确配置"，并显示 DOT 源码 |

**正常可视化表现**：
- 显示彩色的 Petri 网图像
- 包含方框（transitions）和圆圈（places）
- 有箭头连接各节点
- 可以看到 MSG: 和 RES: 前缀的协作 place

---

### 6. 导出功能

| 测试项 | 操作步骤 | 预期结果 |
|--------|----------|----------|
| 下载 PNG | 点击"下载 PNG"按钮 | 下载 `petri_net_n1.png` 文件，可用图片查看器打开 |
| 下载 SVG | 点击"下载 SVG"按钮 | 下载 `petri_net_n1.svg` 文件，可用浏览器或矢量图编辑器打开 |
| 下载 PNML | 点击"下载 PNML"按钮 | 下载 `petri_net_n1.pnml` 文件，可用文本编辑器打开查看 XML 内容 |
| 下载验证报告 | 点击"下载验证报告"按钮 | 下载 `verification_report.txt` 文件，包含完整的挖掘结果摘要 |

---

### 7. 结果查看功能

| 测试项 | 操作步骤 | 预期结果 |
|--------|----------|----------|
| 查看验证报告 | 点击"查看完整验证报告"展开 | 显示文本格式的验证报告，包含日志统计、协作模式、质量指标等 |
| 查看 JSON 结果 | 点击"查看 JSON 结果"展开 | 显示 JSON 格式的完整结果数据 |

---

## 端到端测试流程

### 完整测试流程

1. **启动应用**
   ```powershell
   cd d:\pyhon\big-project1
   streamlit run app.py --server.port 8888
   ```

2. **打开浏览器**
   - 访问 http://localhost:8888

3. **加载日志**
   - 确认"使用示例日志"已勾选
   - 检查日志统计是否显示正确

4. **配置参数**
   - 噪声阈值: 0.2
   - 目标 F-measure: 0.95
   - 最大迭代次数: 3
   - 启用 CE-PNR 修复: 勾选

5. **执行挖掘**
   - 点击"开始挖掘"
   - 等待完成（约 10-30 秒）

6. **验证结果**
   - 检查质量指标是否在合理范围
   - 检查 Petri 网可视化是否正常显示
   - 检查 N0 和 N1 标签页都能正常切换

7. **导出测试**
   - 下载 PNG 并验证可打开
   - 下载 SVG 并验证可打开
   - 下载 PNML 并验证是 XML 格式
   - 下载验证报告并检查内容

---

## 常见问题排查

| 问题 | 可能原因 | 解决方法 |
|------|----------|----------|
| 可视化显示 DOT 源码 | Graphviz 未安装或未添加到 PATH | 安装 Graphviz 并将 `C:\Program Files\Graphviz\bin` 添加到系统 PATH |
| 挖掘失败 | 日志格式不正确 | 检查 CSV 文件是否包含必需列：case_id, tran, timestamp, roles |
| 参数修改无效 | 缓存未清除 | 点击"🔄 清除缓存"后重新挖掘 |
| 页面加载缓慢 | 首次加载需要初始化 | 等待几秒，后续访问会更快 |
| 端口被占用 | 其他程序占用 8888 端口 | 使用 `--server.port 8889` 指定其他端口 |

---

## 验证脚本

可以运行以下脚本进行自动化验证：

```powershell
cd d:\pyhon\big-project1
python verify_all.py
```

该脚本会自动验证：
1. 日志加载功能
2. 过程发现功能
3. 质量评价功能
4. 错误诊断功能
5. 模型修复功能
6. 可视化导出功能

---

## 测试通过标准

- [ ] 日志加载正常，显示正确的统计信息
- [ ] 参数配置可调整，清除缓存后生效
- [ ] 过程挖掘完成，无错误
- [ ] 质量指标显示正常（Fitness, Precision, F-measure 均 > 0）
- [ ] Petri 网可视化显示图像（非 DOT 源码）
- [ ] 所有导出文件可正常下载和打开
- [ ] 验证报告内容完整

---

*文档版本: 1.0*  
*最后更新: 2025-12-26*
